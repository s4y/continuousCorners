<!DOCTYPE html>
<meta name="viewport" content="width=device-width">
<style>

#svgEl.continuous > #roundrect {
  display: none;
}

#svgEl:not(.continuous) > #continuousrect {
  display: none;
}

</style>
<p><label>Continuous: <input id=continuousInput type=checkbox checked></label></p>
<p><label>Radius:<br><input id=radiusInput type=range min=0 max=1 value=0.5 step=0.001></label></p>
<p><svg id=svgEl width=200 height=200 viewBox="-1 -1 2 2">
  <rect id=roundrect rx=0.5 ry=0.5 x=-1 y=-1 width=2 height=2></rect>
  <path id=continuousrect x=1 />
</svg></p>
<script>

const roundrectEl = document.getElementById('roundrect');
const pathEl = document.getElementById('continuousrect');

const rotate = ([x, y], θ) => {
  return [
    x * Math.cos(θ) + y * Math.sin(θ),
    -x * Math.sin(θ) + y * Math.cos(θ),
  ];
};

const updateShape = () => {
  const radius = radiusInput.valueAsNumber;
  const midpointInset = radius - Math.sin(Math.PI * 0.25) * radius;
  const endInset = Math.min(1, midpointInset * 4);

  const rotatePoints = (points, rotation) =>
    points.map(p => rotate(p, Math.PI * rotation))
  ;

  const joinPoints = points =>
    points.map(coord => coord.join(' ')).join(' ')
  ;

  const buildCorner = rotation => `
    L ${joinPoints(rotatePoints([
      [-1, -1+endInset]
    ], rotation))},
    Q ${joinPoints(rotatePoints([
      [-1, -1],
      [-1 + endInset, -1],
    ], rotation))}
  `;

  roundrectEl.setAttribute('rx', radius);
  roundrectEl.setAttribute('ry', radius);
  pathEl.setAttribute('d', `
    M -1 ${1-endInset},
    ${[0, -0.5, -1, -1.5].map(r => buildCorner(r)).join(',')},
  Z`);
}

radiusInput.addEventListener('input', updateShape);
updateShape();

const updateIsContinuous = () => {
  svgEl.classList[continuousInput.checked ? 'add' : 'remove']('continuous');
};

continuousInput.addEventListener('change', updateIsContinuous);
updateIsContinuous();

</script>
